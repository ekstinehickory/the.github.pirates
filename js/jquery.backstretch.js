(function($){$.backstretch=function(src,options,callback){var defaultSettings={centeredX:true,centeredY:true,speed:0},container=$("#backstretch"),settings=container.data("settings")||defaultSettings,existingSettings=container.data("settings"),rootElement=("onorientationchange" in window)?$(document):$(window),imgRatio,bgImg,bgWidth,bgHeight,bgOffset,bgCSS;if(options&&typeof options=="object"){$.extend(settings,options)}if(options&&typeof options=="function"){callback=options}$(document).ready(_init);return this;function _init(){if(src){var img;if(container.length==0){container=$("<div />").attr("id","backstretch").css({left:0,top:0,position:"fixed",overflow:"hidden",zIndex:-999999,margin:0,padding:0,height:"100%",width:"100%"})}else{container.find("img").addClass("deleteable")}img=$("<img />").css({position:"absolute",display:"none",margin:0,padding:0,border:"none",zIndex:-999999}).bind("load",function(e){var self=$(this),imgWidth,imgHeight;self.css({width:"auto",height:"auto"});imgWidth=this.width||$(e.target).width();imgHeight=this.height||$(e.target).height();imgRatio=imgWidth/imgHeight;_adjustBG(function(){self.fadeIn(settings.speed,function(){container.find(".deleteable").remove();if(typeof callback=="function"){callback()}})})}).appendTo(container);if($("body #backstretch").length==0){$("body").append(container)}container.data("settings",settings);img.attr("src",src);$(window).resize(_adjustBG)}}function _adjustBG(fn){try{bgCSS={left:0,top:0};bgWidth=rootElement.width();bgHeight=bgWidth/imgRatio;if(bgHeight>=rootElement.height()){bgOffset=(bgHeight-rootElement.height())/2;if(settings.centeredY){$.extend(bgCSS,{top:"-"+bgOffset+"px"})}}else{bgHeight=rootElement.height();bgWidth=bgHeight*imgRatio;bgOffset=(bgWidth-rootElement.width())/2;if(settings.centeredX){$.extend(bgCSS,{left:"-"+bgOffset+"px"})}}$("#backstretch, #backstretch img:not(.deleteable)").width(bgWidth).height(bgHeight).filter("img").css(bgCSS)}catch(err){}if(typeof fn=="function"){fn()}}}})(jQuery);